# KLayout FIB Tool - Product Requirements Document (PRD)

## Executive Summary

本文档定义了 KLayout FIB 标注工具的产品需求，该工具旨在帮助 IC 设计工程师和失效分析工程师在 GDSII 版图上标注 FIB（聚焦离子束）操作位置，并生成规范的操作指导文档。

---

## 1. Product Overview

### 1.1 产品定位

KLayout FIB Tool 是一款基于 KLayout 平台的插件工具，用于：
- 在芯片版图上精确标注 FIB 操作位置
- 管理和组织多个 FIB 操作
- 生成专业的 FIB 操作指导报告

### 1.2 目标用户

| 用户角色 | 使用场景 |
|----------|----------|
| IC 设计工程师 | 芯片调试阶段，需要标注切断/连接点进行电路修改验证 |
| 失效分析工程师 | 芯片失效分析，需要标注探针测试点和切割点 |
| 测试工程师 | 测试方案制定，需要规划探针测试位置 |
| FIB 实验室操作员 | 根据生成的报告执行实际 FIB 操作 |

### 1.3 产品价值

| 价值点 | 描述 |
|--------|------|
| 提高效率 | 替代手工绘图标注，缩短 FIB 准备时间 50%+ |
| 减少错误 | 精确坐标记录，避免手工标注的位置偏差 |
| 标准化输出 | 生成统一格式的操作文档，便于 FIB 实验室执行 |
| 可追溯性 | 完整记录所有操作，便于后续复盘和知识积累 |

---

## 2. Feature Specifications

### 2.1 核心功能模块

```
┌─────────────────────────────────────────────────────────────┐
│                    KLayout FIB Tool                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │   标注模块   │  │   管理模块   │  │   输出模块   │          │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤          │
│  │ • CUT 标注  │  │ • 分组管理   │  │ • GDS 导出  │          │
│  │ • CONNECT   │  │ • 属性编辑   │  │ • HTML 报告 │          │
│  │ • PROBE 标注│  │ • 状态保存   │  │ • PDF 报告  │          │
│  │ • 交互操作   │  │ • 状态加载   │  │ • 截图生成  │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 Feature: CUT（切断标注）

#### 2.2.1 功能描述
在版图上标注需要使用 FIB 切断的金属连线位置，记录切断点坐标和切断方向。

#### 2.2.2 用户故事
> 作为一名 IC 设计工程师，我需要在版图上标注需要切断的金属线位置，以便 FIB 实验室能够准确找到并执行切断操作。

#### 2.2.3 操作流程

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  点击 Cut    │───▶│  点击版图上   │───▶│  点击第二点   │───▶│  标记创建    │
│  按钮激活    │    │  切断位置     │    │  确定方向     │    │  完成        │
└──────────────┘    └──────────────┘    └──────────────┘    └──────────────┘
```

#### 2.2.4 UI 设计

```
┌─────────────────────────────────────┐
│  [Cut] [Connect] [Probe]            │  ← 操作按钮（Cut 高亮时表示激活）
├─────────────────────────────────────┤
│                                     │
│      版图显示区域                    │
│                                     │
│           ╲ /                       │
│            X ──▶  CUT_0             │  ← 切断标记示意
│           / ╲    (52.08, 68.07)     │
│                                     │
└─────────────────────────────────────┘
```

#### 2.2.5 标记样式

| 元素 | 样式 | 说明 |
|------|------|------|
| 切断符号 | X 形交叉 | 表示切断位置 |
| 方向箭头 | 单向箭头 | 从 X 中心指向切断方向 |
| 标签 | 文本 | 显示 "CUT_n" 和坐标 |
| 颜色 | 红色（默认） | 可配置 |

#### 2.2.6 数据记录

```
CUT 操作数据：
├── ID: CUT_0, CUT_1, ...
├── 坐标: (X, Y) 单位 μm
├── 方向: up / down / left / right
├── 目标 Layer: layer_number:datatype
├── 标签/备注: 用户自定义文本
└── 所属分组: Group ID
```

---

### 2.3 Feature: CONNECT（连接标注）

#### 2.3.1 功能描述
在版图上标注需要使用 FIB 沉积金属连接的两个点，记录起点和终点坐标。

#### 2.3.2 用户故事
> 作为一名 IC 设计工程师，我需要在版图上标注需要连接的两个金属点，以便 FIB 实验室能够准确沉积金属进行连接。

#### 2.3.3 操作流程

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  点击Connect │───▶│  点击版图上   │───▶│  点击版图上   │───▶│  连接线创建  │
│  按钮激活    │    │  起点位置     │    │  终点位置     │    │  完成        │
└──────────────┘    └──────────────┘    └──────────────┘    └──────────────┘
```

#### 2.3.4 UI 设计

```
┌─────────────────────────────────────┐
│  [Cut] [Connect] [Probe]            │  ← 操作按钮（Connect 高亮时表示激活）
├─────────────────────────────────────┤
│                                     │
│      版图显示区域                    │
│                                     │
│      ●────────────────●             │
│   (100,200)    CONNECT_0   (150,250)│  ← 连接标记示意
│                                     │
└─────────────────────────────────────┘
```

#### 2.3.5 标记样式

| 元素 | 样式 | 说明 |
|------|------|------|
| 连接线 | 直线/折线 | 从起点到终点 |
| 端点符号 | 圆形 | 起点和终点位置 |
| 标签 | 文本 | 显示 "CONNECT_n" |
| 颜色 | 蓝色（默认） | 可配置 |

---

### 2.4 Feature: PROBE（探针标注）

#### 2.4.1 功能描述
在版图上标注需要进行探针测试的位置，用于 FIB 开窗露出金属层。

#### 2.4.2 用户故事
> 作为一名测试工程师，我需要在版图上标注探针测试点位置，以便 FIB 实验室能够准确开窗露出测试点。

#### 2.4.3 操作流程

```
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  点击 Probe  │───▶│  点击版图上   │───▶│  探针标记    │
│  按钮激活    │    │  探测位置     │    │  创建完成    │
└──────────────┘    └──────────────┘    └──────────────┘
```

#### 2.4.4 标记样式

| 元素 | 样式 | 说明 |
|------|------|------|
| 探针符号 | 向下箭头 ↓ | 表示探针位置 |
| 标签 | 文本 | 显示 "PROBE_n" 和坐标 |
| 颜色 | 绿色（默认） | 可配置 |

---

### 2.5 Feature: 分组管理

#### 2.5.1 功能描述
将多个 FIB 操作组织成分组，便于管理和生成报告。

#### 2.5.2 UI 设计

```
┌─────────────────────────────────────┐
│  FIB Doc Structure                  │
├─────────────────────────────────────┤
│  ▼ Group                            │
│  ├─ ☑ g1                           │
│  │   ├─ box: (46.08,-11.5,70.53,138.89) │
│  │   ├─ layers: 1.0;3.0;4.0;5.0... │
│  │   ├─ Notes: "..."               │
│  │   ├─ Screenshots: 2             │
│  │   ├─ ⊕ CUT_0                    │
│  │   ├─ ⊕ CONNECT_0                │
│  │   └─ ⊕ PROBE_0                  │
│  └─ ☐ g2                           │
├─────────────────────────────────────┤
│  [New Group] [Delete] [Edit]        │
└─────────────────────────────────────┘
```

#### 2.5.3 分组属性

| 属性 | 说明 |
|------|------|
| 名称 | 分组名称 |
| 边界框 | 分组覆盖的版图区域 |
| 图层列表 | 分组包含的 Layer |
| 备注 | 用户添加的说明文字 |
| 截图数量 | 关联的截图数量 |
| 操作列表 | 包含的 CUT/CONNECT/PROBE 操作 |

---

### 2.6 Feature: 报告生成

#### 2.6.1 功能描述
生成包含所有 FIB 操作信息的 HTML/PDF 报告，供 FIB 实验室使用。

#### 2.6.2 报告结构

```
┌─────────────────────────────────────────────────────────────┐
│                       FIB Report                            │
├─────────────────────────────────────────────────────────────┤
│  Header:                                                    │
│  ├─ Name: grp-lili                                         │
│  ├─ Lib: cdr_bye                                           │
│  ├─ Cell: cdr_bye                                          │
│  ├─ Query BBox: (150.545, 58.995, 328.075, 175.355)       │
│  └─ Extracted layers: {4.0:PPoly} {6.0:Metal1} ...        │
├─────────────────────────────────────────────────────────────┤
│  Group Notes:                                               │
│  • by lili, 01-01-2014, BJ cir1                            │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  Snapshot Area  │  │  All Operations │                  │
│  │  (全局视图)      │  │  (操作总览)      │                  │
│  └─────────────────┘  └─────────────────┘                  │
├─────────────────────────────────────────────────────────────┤
│  Operation Details:                                         │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ grp-lili - CUT_0                                        ││
│  │ • CUT_0(223.615, 65.7)down@{6.0}                       ││
│  │ ┌─────────────────┐  ┌─────────────────┐               ││
│  │ │  Snapshot Area  │  │ Local Area View │               ││
│  │ └─────────────────┘  └─────────────────┘               ││
│  │ ┌─────────────────────────────────────┐                ││
│  │ │         Detailed View               │                ││
│  │ └─────────────────────────────────────┘                ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

#### 2.6.3 三级视图说明

| 视图级别 | 用途 | 默认比例 |
|----------|------|----------|
| Snapshot Area | 显示操作点在芯片中的整体位置 | 1:10 |
| Local Area View | 显示操作点周围的局部区域 | 1:1 |
| Detailed View | 显示操作点的精确位置细节 | 5:1 |

#### 2.6.4 PDF 图片放大功能

PDF 报告支持图片放大功能，便于 FIB 操作员查看细节：

| 参数 | 说明 | 默认值 | 范围 |
|------|------|--------|------|
| 全局放大倍数 | 统一应用于所有截图 | 2.0x | 1.0x - 10.0x |
| 全局视图放大 | Snapshot Area 放大倍数 | 1.5x | 1.0x - 10.0x |
| 局部视图放大 | Local Area View 放大倍数 | 2.0x | 1.0x - 10.0x |
| 详细视图放大 | Detailed View 放大倍数 | 3.0x | 1.0x - 10.0x |
| 放大步进 | 调节放大倍数的步进值 | 0.5x | - |

**使用场景**：
- FIB 操作员需要在打印的 PDF 上看清微米级别的标记位置
- 不同视图级别需要不同的放大倍数以平衡细节和整体可读性
- 高放大倍数适用于精细定位，低放大倍数适用于全局定位

---

### 2.7 Feature: 数据保存与加载

#### 2.7.1 保存功能

```
┌─────────────────────────────────────┐
│         Save FIB Status             │
├─────────────────────────────────────┤
│  XML File: [________________] [📂]  │
│                                     │
│  [OK]  [Cancel]                     │
└─────────────────────────────────────┘
```

#### 2.7.2 导出功能

```
┌─────────────────────────────────────────────────────┐
│              Generate Result                        │
├─────────────────────────────────────────────────────┤
│  ☑ Operation Report                                 │
│    HTML File: [./fib.html___________] [📂]          │
│    ☑ Also generate in pdf file                      │
│                                                     │
│    ┌─ PDF Image Zoom Settings ───────────────────┐  │
│    │  ☐ Use uniform zoom for all views           │  │
│    │     Zoom Factor: [2.0x ▼] (1.0x - 10.0x)    │  │
│    │                                             │  │
│    │  ☑ Per-view zoom settings:                  │  │
│    │     Overview (Snapshot):  [1.5x ▼]          │  │
│    │     Local Area View:      [2.0x ▼]          │  │
│    │     Detailed View:        [3.0x ▼]          │  │
│    └─────────────────────────────────────────────┘  │
│                                                     │
│  ☑ Layout                                           │
│    GDSII File: [./fib.gds___________] [📂]          │
│    ☐ gz file format                                 │
│                                                     │
│  [OK]  [Cancel]                                     │
└─────────────────────────────────────────────────────┘
```

**PDF 图片放大说明**：
- **统一放大模式**：所有截图使用相同的放大倍数
- **分级放大模式**：为每个视图级别设置独立的放大倍数
- 放大倍数范围：1.0x ~ 10.0x，步进 0.5x
- 更高的放大倍数会增加 PDF 文件大小

---

## 3. User Interface Design

### 3.1 主界面布局

```
┌──────────────────────────────────────────────────────────────────────────┐
│  KLayout FIB Tool                                            [_][□][X]   │
├──────────────────────────────────────────────────────────────────────────┤
│  [New] [Close]      [More ▼]                              [GenData]      │
│                      ├─ Load                                             │
│                      ├─ ImportSub                                        │
│                      └─ Save                                             │
├────────────────────────────────────┬─────────────────────────────────────┤
│  Current FIB Project               │                                     │
│  ┌──────────┬──────────┐          │                                     │
│  │  Report  │  Layout  │          │                                     │
│  └──────────┴──────────┘          │                                     │
│  ☑ AutoCutGroupRegion              │                                     │
│  MarginX: [6    ] MarginY: [66  ] │                                     │
│                                    │                                     │
│  Add ─────────────────────────     │       版图显示区域                   │
│  [  Cut  ] [Connect] [ Probe ]     │                                     │
│                                    │                                     │
│  FIB Doc Structure ────────────    │                                     │
│  [Group] [CornerPicture] [Edit]    │                                     │
│  ☑ SelectAll                       │                                     │
│  ─────────────────────────────     │                                     │
│  General Notes                     │                                     │
│  Corner Screenshots          0     │                                     │
│  ▼ ☐ g1                           │                                     │
│     ├─ box    (46.08,-11.5...)    │                                     │
│     ├─ layers 1.0;3.0;4.0;5.0...  │                                     │
│     ├─ Notes                      │                                     │
│     ├─ Screenshots           2    │                                     │
│     ├─ ⊕ CUT_0                    │                                     │
│     ├─ ⊕ CONNECT_0                │                                     │
│     └─ ⊕ PROBE_0                  │                                     │
│                                    │                                     │
└────────────────────────────────────┴─────────────────────────────────────┘
```

### 3.2 快捷键设计

| 快捷键 | 功能 |
|--------|------|
| C | 激活 CUT 模式 |
| N | 激活 CONNECT 模式 |
| P | 激活 PROBE 模式 |
| Esc | 取消当前操作 |
| Delete | 删除选中的标记 |
| Ctrl+Z | 撤销 |
| Ctrl+Y | 重做 |
| Ctrl+S | 保存状态 |
| Ctrl+G | 新建分组 |

### 3.3 右键菜单

```
┌─────────────────┐
│ Edit            │
│ Delete          │
│ ───────────     │
│ Move to Group ▶ │
│ Add Note        │
│ ───────────     │
│ Zoom to Fit     │
└─────────────────┘
```

---

## 4. User Workflows

### 4.1 典型工作流程

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           FIB 标注工作流程                                │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  Step 1: 加载版图文件      │
                    │  File → Open GDS/OASIS    │
                    └───────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  Step 2: 启动 FIB 工具     │
                    │  Tools → FIB              │
                    └───────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  Step 3: 创建分组（可选）   │
                    │  点击 Group 按钮          │
                    └───────────────────────────┘
                                    │
                                    ▼
            ┌───────────────────────┴───────────────────────┐
            │                                               │
            ▼                       ▼                       ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  添加 CUT 标记   │     │ 添加 CONNECT 标记│     │  添加 PROBE 标记 │
│  1. 点击 Cut    │     │  1. 点击Connect │     │  1. 点击 Probe  │
│  2. 点击位置    │     │  2. 点击起点    │     │  2. 点击位置    │
│  3. 点击方向    │     │  3. 点击终点    │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
            │                       │                       │
            └───────────────────────┴───────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  Step 4: 添加备注（可选）   │
                    │  编辑 Group Notes         │
                    └───────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  Step 5: 保存 FIB 状态     │
                    │  More → Save             │
                    └───────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  Step 6: 生成报告/GDS     │
                    │  点击 GenData            │
                    └───────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    ▼                               ▼
        ┌─────────────────┐             ┌─────────────────┐
        │  HTML/PDF 报告   │             │   GDS 文件      │
        │  供 FIB 实验室   │             │  包含标记层     │
        └─────────────────┘             └─────────────────┘
```

### 4.2 场景示例

#### 场景 1：芯片调试 - 切断信号线

**背景**：工程师发现某信号线存在短路，需要切断验证

**步骤**：
1. 打开版图文件，定位到问题区域
2. 启动 FIB 工具，创建新分组 "Signal_Short_Fix"
3. 使用 CUT 功能在短路位置添加切断标记
4. 添加备注说明切断原因
5. 生成 HTML 报告发送给 FIB 实验室
6. 保存 FIB 状态以便后续追踪

#### 场景 2：失效分析 - 多点探测

**背景**：工程师需要在多个关键节点进行探针测试

**步骤**：
1. 打开版图文件
2. 启动 FIB 工具，创建分组 "FA_Probe_Plan"
3. 使用 PROBE 功能依次添加所有探测点
4. 为每个探测点添加标签（如 VDD、GND、CLK 等）
5. 生成报告并导出包含标记的 GDS
6. 将报告和 GDS 发送给 FIB 实验室

---

## 5. Success Metrics

### 5.1 用户体验指标

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| 首次使用学习时间 | < 30 分钟 | 用户测试 |
| 单个标记创建时间 | < 5 秒 | 操作计时 |
| 报告生成时间 | < 30 秒 | 系统计时 |
| 用户满意度 | > 4.0/5.0 | 用户调研 |

### 5.2 质量指标

| 指标 | 目标值 |
|------|--------|
| 坐标精度 | ± 0.001 μm |
| 报告正确性 | 100% |
| 软件稳定性（无崩溃运行） | > 100 小时 |

---

## 6. Release Plan

### 6.1 版本规划

#### v1.0 - MVP (Minimum Viable Product)

**目标**：实现核心标注功能

| 功能 | 状态 |
|------|------|
| CUT 标注 | 必须 |
| CONNECT 标注 | 必须 |
| PROBE 标注 | 必须 |
| 基本分组管理 | 必须 |
| XML 状态保存/加载 | 必须 |
| HTML 报告生成 | 必须 |
| PDF 报告生成（含图片放大功能） | 必须 |
| GDS 导出（含标记层） | 必须 |

#### v1.1 - Enhancement

**目标**：提升用户体验

| 功能 | 状态 |
|------|------|
| 快捷键支持 | 新增 |
| 撤销/重做 | 新增 |
| 自定义标记颜色 | 新增 |
| 区域裁剪导出 | 新增 |
| 分视图级别放大倍数预设模板 | 新增 |

#### v2.0 - Advanced

**目标**：专业功能增强

| 功能 | 状态 |
|------|------|
| 多段折线 CONNECT | 新增 |
| 自定义报告模板 | 新增 |
| 批量操作导入 | 新增 |
| 与 Calibre DRC 集成 | 新增 |
| Net 追踪与高亮 | 新增 |

### 6.2 开发里程碑

```
Timeline:
─────────────────────────────────────────────────────────────────────
Week 1-2     Week 3-4     Week 5-6     Week 7-8     Week 9-10
─────────────────────────────────────────────────────────────────────
   │            │            │            │            │
   ▼            ▼            ▼            ▼            ▼
┌──────┐    ┌──────┐    ┌──────┐    ┌──────┐    ┌──────┐
│框架   │    │标注   │    │分组   │    │报告   │    │测试   │
│搭建   │    │功能   │    │管理   │    │生成   │    │发布   │
└──────┘    └──────┘    └──────┘    └──────┘    └──────┘
```

---

## 7. Risk Assessment

### 7.1 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| KLayout API 限制 | 中 | 高 | 提前进行 API 可行性验证 |
| 大型 GDS 性能问题 | 中 | 中 | 实现增量加载和区域裁剪 |
| 跨平台兼容性 | 低 | 中 | 使用标准 Python 库，充分测试 |

### 7.2 项目风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 需求变更 | 中 | 中 | 采用敏捷开发，快速迭代 |
| 用户接受度低 | 低 | 高 | 早期用户参与测试，收集反馈 |

---

## 8. Appendix

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| FIB | Focused Ion Beam，聚焦离子束，用于芯片微修 |
| CUT | 切断操作，用 FIB 切断金属连线 |
| CONNECT | 连接操作，用 FIB 沉积金属连接两点 |
| PROBE | 探针操作，用 FIB 开窗露出金属层供探针测试 |
| GDSII | Graphic Data System II，IC 版图标准文件格式 |
| Layer | 版图中的图层 |
| Datatype | Layer 的数据类型属性 |
| BBox | Bounding Box，边界框 |

### 8.2 参考文档

1. Skipper EDA FIB 功能文档
2. KLayout Python API 文档
3. GDSII 文件格式规范

### 8.3 竞品分析

| 功能 | Skipper FIB | KLayout FIB Tool (本产品) |
|------|-------------|---------------------------|
| CUT/CONNECT/PROBE | ✓ | ✓ |
| 分组管理 | ✓ | ✓ |
| HTML/PDF 报告 | ✓ | ✓ |
| GDS 导出 | ✓ | ✓ |
| Net 追踪 | ✓ | v2.0 规划 |
| 免费开源 | ✗ | ✓ |
| 跨平台 | 有限 | ✓ (Win/Linux/Mac) |

---

## Document History

| 版本 | 日期 | 作者 | 描述 |
|------|------|------|------|
| 0.1 | 2024-12-01 | - | 初始版本 |
